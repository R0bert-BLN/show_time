{% extends 'public/base.html.twig' %}

{% block title %}Cart{% endblock %}

{% block content %}
    <div class="w-2/6 mx-auto px-5 py-2 flex flex-col mt-10 mb-10">
        <h1 class="text-[35px] text-[#ca8f53] font-bold text-center mb-5">My Cart</h1>

        {% for item in cart %}
            {% include 'public/cart_history/components/_cart_item_row.html.twig' with {'item': item} %}
        {% else %}
            <div id="cart-empty-message" class="flex justify-center items-center mt-10">
                <p class="text-[25px] text-[#ca8f53] font-semibold">Cart is empty</p>
            </div>
        {% endfor %}

        {% if cart is not empty %}
        <div id="cart-total" class="flex justify-between items-center w-full py-4 px-6 my-3 border-[#ca8f53] border-b-2">
            {% include 'public/cart_history/components/_cart_total.html.twig' with {'total': total} %}
        </div>

        <div class="flex justify-center">
            <button id="checkout-button" type="button" class="px-10 mt-3 py-2 font-bold text-[20px] bg-[#ca8f53] text-[#202020] cursor-pointer rounded-md hover:opacity-80">Checkout</button>
        </div>

        {% endif %}
    </div>

    <script>
        const stripe = Stripe('{{ stripe_public_key }}');

        document.getElementById('checkout-button').addEventListener('click', () => {
            fetch('/checkout/session/create', {method: 'POST'})
                .then(res => res.json())
                .then(data => stripe.redirectToCheckout({ sessionId: data.id }));
        });
    </script>
{% endblock %}
